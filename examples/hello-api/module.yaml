kind: Runtime.Module
metadata:
  name: Example
  version: 1.0.0
imports:
  - ../../modules/http-server
  - ../../modules/data
  - ../../modules/javascript
---
kind: Http.Server
metadata:
  name: Example
  module: Example
baseUrl: http://localhost:8844
port: 8844
logger: true
openapi:
  info:
    title: Hello server
    version: 1.0.0
mounts:
  - path: /v1
    type: Http.Api.HelloApi
---
kind: Http.Api
metadata:
  name: HelloApi
  module: Example
routes:
  - request:
      path: /hello
      method: GET
      schema:
        query:
          type: object
          properties:
            name:
              type: string
          required: ["name"]
    handler:
      kind: JavaScript.Script
      name: SayHello
      inputs:
        name: "${{ request.query.name }}" # CEL expression
    response:
      status: 200
      statuses:
        "200":
          schema:
            body:
              type: object
              properties:
                greeting:
                  type: string
                nice:
                  type: string
              required: ["greeting", "nice"]
              additionalProperties: false
          headers:
            Content-Type: application/json
          body:
            greeting: "${{ result.message }}!"
            nice: "WOW"
---
kind: JavaScript.Script
metadata:
  name: SayHello
  module: Example
code: |
  function main({ name }) {
    return {
      message: `Hello ${name}!`,
    }
  };
inputSchema:
  name:
    type: string
outputSchema:
  message:
    type: string
