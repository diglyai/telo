---
# Test resources for HTTP server testing

kind: Http.Server
metadata:
  name: TestApi
port: 9001
routes:
  - path: /v1/health
    method: GET
    handler: Logic.JavaScript.HealthCheck
  - path: /v1/greet
    method: GET
    handler: Logic.JavaScript.GreetHandler
  - path: /v1/users
    method: POST
    handler: Logic.JavaScript.CreateUser
  - path: /v1/data
    method: GET
    handler: Logic.JavaScript.GetData
  - path: /v1/status
    method: GET
    handler: Logic.JavaScript.GetStatus

---
kind: Logic.JavaScript
metadata:
  name: HealthCheck
code: |
  function main(input) {
    return {
      status: "healthy",
      timestamp: new Date().toISOString()
    }
  }

---
kind: Logic.JavaScript
metadata:
  name: GreetHandler
code: |
  function main(input) {
    const name = input.query?.name || 'World';
    return {
      greeting: `Hello, ${name}!`,
      timestamp: new Date().toISOString()
    }
  }

---
kind: Logic.JavaScript
metadata:
  name: CreateUser
code: |
  function main(input) {
    const { name, email } = input.body;
    return {
      id: Math.floor(Math.random() * 10000),
      name: name,
      email: email,
      createdAt: new Date().toISOString()
    }
  }

---
kind: Logic.JavaScript
metadata:
  name: GetData
code: |
  function main(input) {
    return [
      { id: 1, name: 'Item 1' },
      { id: 2, name: 'Item 2' },
      { id: 3, name: 'Item 3' }
    ]
  }

---
kind: Logic.JavaScript
metadata:
  name: GetStatus
code: |
  function main(input) {
    return {
      status: "operational",
      uptime: Math.floor(Math.random() * 10000),
      timestamp: new Date().toISOString()
    }
  }

---
kind: Logic.JavaScript
metadata:
  name: Initialize
code: |
  function main({ config }) {
    return {
      initialized: true,
      config: config,
      timestamp: new Date().toISOString()
    }
  }
