---
# Template Definition - defines the schema and resource blueprints
kind: TemplateDefinition
metadata:
  name: ApiServer
schema:
  type: object
  properties:
    name:
      type: string
      default: 'example'
    port:
      type: integer
      default: 8080
    regions:
      type: array
      items:
        type: string
      default: ['us-east', 'eu-west']
    enableOpenApi:
      type: boolean
      default: true
  required: [name, port]
resources:
  # Generate an API for each region
  - for: "region in regions"
    kind: Http.Api
    metadata:
      name: "${{ name }}-${{ region }}-api"
    routes: []
    region: "${{ region }}"
  
  # Conditionally generate OpenAPI spec
  - if: "enableOpenApi"
    kind: OpenApi.Spec
    metadata:
      name: "${{ name }}-openapi"
    apis:
      # Reference all the generated APIs
      - for: "region in regions"
        resource: "Http.Api.${{ name }}-${{ region }}-api"

---
# Example: Instantiate the template
kind: Template.ApiServer
metadata:
  name: MyProductionApi
name: 'production'
port: 3000
regions: ['us-east-1', 'us-west-2', 'eu-central-1']
enableOpenApi: true
