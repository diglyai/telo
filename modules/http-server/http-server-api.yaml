kind: "Runtime.Definition"
metadata:
  name: "HttpApiDefinition"
  resourceKind: "Api"
  module: "Http"
controllers:
  - runtime: nodejs
    registry: npm
    package: "@vokerun/http-server@1.0.0"
    entry: "./http-server-api"
  - runtime: nodejs
    registry: local
    package: "./nodejs"
    entry: "./http-server-api"
schema:
  type: "object"
  properties:
    routes:
      type: "array"
      items:
        type: "object"
        properties:
          request:
            type: "object"
            properties:
              path:
                type: "string"
              method:
                type: "string"
                enum: ["GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS"]
              query:
                type: "object"
              body:
                type: "object"
              headers:
                type: "object"
            required: ["path", "method"]
          handler:
            oneOf:
              - type: "string"
              - type: "object"
                properties:
                  kind:
                    type: "string"
                  type:
                    type: "string"
          response:
            type: "object"
            properties:
              status:
                type: "integer"
              headers:
                type: "object"
              body:
                oneOf:
                  - type: "string"
                  - type: "object"
              schema:
                type: "object"
                description: "Response schema definition"
                properties:
                  status:
                    type: "integer"
                  headers:
                    type: "object"
                  body:
                    type: "object"
              mapping:
                type: "object"
                description: "Response mapping expressions"
                properties:
                  status:
                    type: "string"
                  headers:
                    type: "object"
                    additionalProperties:
                      type: "string"
                  body:
                    type: "string"
  required: ["routes"]
