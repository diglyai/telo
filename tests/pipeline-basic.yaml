kind: Runtime.Module
metadata:
  name: PipelineBasic
  version: 1.0.0
imports:
  - ../modules/pipeline
  - ../modules/javascript
  - ../modules/assert
---
kind: Pipeline.Job
metadata:
  name: TestBasicAddition
  description: Test basic JavaScript addition
  module: PipelineBasic
steps:
  - name: AddTwoNumbers
    invoke:
      kind: JavaScript.Script
      code: |
        function main({ a, b }) {
          return a + b;
        }
    input:
      a: 5
      b: 3

  - name: VerifyResult
    input:
      sum: "${{ AddTwoNumbers.output }}"
    invoke:
      kind: Assert.Schema
      schema:
        type: object
        properties:
          sum:
            type: number
            const: 8
---
kind: Assert.Events
metadata:
  module: PipelineBasic
  name: ExpectEvents
filter:
  - type: "*"
expect:
  - event: PipelineBasic.JavaScript.Script.*.Incitod
    payload:
      result: 8
  - event: PipelineBasic.Assert.Schema.*.Incitod
    payload:
      result: true
